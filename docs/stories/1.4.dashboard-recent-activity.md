# Story 1.4: Dashboard with Recent Activity

## Status
Draft

## Story
**As a** professional user,
**I want** a dashboard that shows my recent notes, documents, and voice recordings with storage usage overview,
**so that** I can quickly access my latest work and monitor my account usage.

## Acceptance Criteria
1. Dashboard displays recent activity feed showing latest notes, uploads, and recordings with timestamps
2. Storage usage display showing notes count, documents count, and total storage with visual indicators
3. Quick action buttons for creating new notes, uploading documents, and starting voice recordings
4. Existing authentication system controls dashboard access and personalizes content display
5. New functionality follows existing TanStack Query patterns for efficient data fetching and caching
6. Integration with all content types maintains consistent data presentation and navigation
7. Dashboard data fetching and display covered by appropriate tests including loading states and error handling
8. Dashboard UI follows existing Shadcn-ui design system with responsive layout for mobile and desktop
9. No regression in existing navigation, authentication, or content access functionality verified

## Tasks / Subtasks

- [ ] Task 1: Create Dashboard Data Aggregation APIs (AC: 1, 2, 5)
  - [ ] Create dashboard router in `apps/server/src/routers/dashboard.ts`
  - [ ] Implement recent activity aggregation endpoint across notes, documents, and voice
  - [ ] Add storage usage calculation endpoint with breakdown by content type
  - [ ] Create user statistics endpoint (total counts, usage metrics)
  - [ ] Include proper pagination for activity feed with configurable limits

- [ ] Task 2: Design Dashboard Layout Structure (AC: 3, 8)
  - [ ] Create dashboard page in `apps/web/src/app/dashboard/`
  - [ ] Design responsive grid layout for activity feed and storage overview
  - [ ] Create quick action toolbar component with accessible button controls
  - [ ] Add mobile-first responsive breakpoints for different screen sizes
  - [ ] Follow Shadcn-ui design system with consistent spacing and typography

- [ ] Task 3: Build Recent Activity Feed Component (AC: 1, 6, 8)
  - [ ] Create activity feed component in `apps/web/src/components/dashboard/`
  - [ ] Design activity item cards for different content types (notes, documents, voice)
  - [ ] Add activity type icons and timestamps with relative time display
  - [ ] Implement activity item click navigation to respective content
  - [ ] Add infinite scroll or pagination for activity history

- [ ] Task 4: Create Storage Usage Overview (AC: 2, 8)
  - [ ] Build storage usage component with visual progress indicators
  - [ ] Add breakdown by content type with color-coded categories
  - [ ] Create storage usage charts using appropriate chart library
  - [ ] Add storage limit warnings and upgrade prompts (future enhancement hooks)
  - [ ] Include detailed storage breakdown tooltip or modal

- [ ] Task 5: Implement Quick Action Controls (AC: 3, 8)
  - [ ] Create quick action button component with keyboard navigation
  - [ ] Add new note creation action with direct navigation
  - [ ] Implement document upload trigger with file picker integration
  - [ ] Add voice recording starter with permission checks
  - [ ] Include accessibility labels and screen reader support

- [ ] Task 6: Dashboard Data Integration (AC: 4, 5, 6)
  - [ ] Set up oRPC client integration for dashboard data fetching
  - [ ] Integrate TanStack Query for efficient data caching and updates
  - [ ] Add real-time data refresh capabilities for activity feed
  - [ ] Implement proper loading states and skeleton components
  - [ ] Add error handling with retry mechanisms

- [ ] Task 7: Navigation and Search Integration (AC: 6, 9)
  - [ ] Integrate dashboard with existing navigation structure
  - [ ] Add dashboard search functionality across all content types
  - [ ] Create breadcrumb navigation for dashboard sections
  - [ ] Implement deep linking for dashboard filters and views
  - [ ] Ensure proper routing and browser history management

- [ ] Task 8: Performance Optimization (AC: 5, 7)
  - [ ] Implement efficient data aggregation queries with proper indexing
  - [ ] Add client-side caching for dashboard data with appropriate TTL
  - [ ] Optimize image loading for content thumbnails and previews
  - [ ] Add lazy loading for non-critical dashboard sections
  - [ ] Implement data prefetching for improved user experience

- [ ] Task 9: Testing Implementation (AC: 7, 9)
  - [ ] Write unit tests for dashboard data aggregation APIs
  - [ ] Create E2E tests for dashboard navigation and interaction workflows
  - [ ] Test responsive design across different device sizes
  - [ ] Verify dashboard performance with large data sets
  - [ ] Test integration with all content types and authentication

## Dev Notes

### Testing Standards
**Location**: E2E tests in `tests/e2e/`, unit tests co-located with source files
**Framework**: Playwright for E2E testing, Bun test runner for unit tests
**Standards**: [Source: architecture.md#Testing Architecture]
- Test dashboard data aggregation with mock data sets
- Verify responsive design across viewport sizes
- Test quick action integrations with content creation flows
- Mock activity feed with various content types and timestamps

### Architecture Context

**Technology Stack**: [Source: architecture.md#Technology Stack]
- **Backend**: Next.js API Routes, oRPC (1.8.6), Drizzle ORM (0.44.2), SQLite with LibSQL
- **Frontend**: Next.js 15.5.0 with App Router, TanStack Query (5.85.5), Shadcn-ui, Tailwind CSS
- **State Management**: TanStack Query for server state, React hooks for local state
- **UI Components**: Shadcn-ui components built on Radix UI primitives

**Project Structure**: [Source: architecture.md#Project Structure]
- **Dashboard Pages**: `apps/web/src/app/dashboard/`
- **Dashboard Components**: `apps/web/src/components/dashboard/`
- **API Routers**: `apps/server/src/routers/dashboard.ts`
- **Shared UI Components**: `apps/web/src/components/ui/`

**Database Architecture**: [Source: architecture.md#Database Architecture]
- Aggregates data from existing tables: notes (Story 1.1), documents (Story 1.2), audio_transcriptions (Story 1.3)
- Efficient queries with proper joins and indexing
- User-based data filtering with auth.user relationships
- Optimized counting and storage calculation queries

**API Architecture (oRPC)**: [Source: architecture.md#API Architecture]
- **Server Side**: Context-aware procedures with authentication middleware
- **Client Side**: TanStack Query integration for efficient data fetching
- Type-safe data aggregation with proper error handling
- Cached responses for improved dashboard performance

**Frontend Architecture**: [Source: architecture.md#Frontend Architecture]
- **Component Structure**: Dashboard components following Shadcn-ui patterns
- **State Management**: TanStack Query for server state, React Context for dashboard settings
- **Responsive Design**: Tailwind CSS utility classes for mobile-first design
- **Navigation**: Integration with existing Next.js App Router structure

**Performance Optimizations**: [Source: architecture.md#Performance Optimizations]
- **Database**: Efficient aggregation queries with proper indexing
- **Frontend**: Component code splitting and lazy loading
- **Caching**: TanStack Query caching strategies for dashboard data
- **Images**: Next.js Image component optimization for content previews

### File Locations
- **Dashboard Router**: `apps/server/src/routers/dashboard.ts`
- **Dashboard Page**: `apps/web/src/app/dashboard/page.tsx`
- **Activity Feed**: `apps/web/src/components/dashboard/activity-feed.tsx`
- **Storage Overview**: `apps/web/src/components/dashboard/storage-overview.tsx`
- **Quick Actions**: `apps/web/src/components/dashboard/quick-actions.tsx`
- **E2E Tests**: `tests/e2e/dashboard.spec.ts`

### Technical Constraints
- Dashboard must aggregate data from all content types efficiently
- Real-time updates without overwhelming server with requests
- Responsive design requirements for mobile and desktop
- Must integrate with existing authentication and navigation systems
- Follow oRPC patterns for all API communications

### Dependencies
- **Required**: Stories 1.1, 1.2, and 1.3 must be completed for content aggregation
- **Builds on**: Existing authentication, navigation, and content creation systems
- **Integrates with**: All content types (notes, documents, voice recordings)

### Data Sources
- **Notes**: From Story 1.1 notes table (title, created_at, updated_at, user_id)
- **Documents**: From Story 1.2 documents table (filename, processing_status, file_size, created_at)
- **Voice Recordings**: From Story 1.3 audio_transcriptions table (duration, transcription_status, created_at)
- **Storage**: Calculated from file sizes and content counts across all tables

### Performance Considerations
- Dashboard queries should be optimized with appropriate database indexes
- Activity feed pagination to handle users with large content volumes
- Storage calculations should be cached and updated efficiently
- Real-time updates should use polling or WebSocket connections appropriately

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-28 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation*