# Story 1.1: Manual Note-Taking with AI Summarization

## Status

Ready for Review

## Story

**As a** professional user,
**I want** to create rich-text notes with formatting and generate AI summaries with one click,
**so that** I can quickly capture information and extract key insights without manual summarization work.

## Acceptance Criteria

1. Users can create and edit notes using a rich-text editor with formatting capabilities (bold, italic, bullet points, headers)
2. AI summarization button generates executive, bullet point, or action-item format summaries
3. Notes are automatically saved and stored in the database with user association
4. Existing authentication system controls note access and ownership
5. New functionality follows existing oRPC API pattern for type-safe client-server communication
6. Integration with Drizzle ORM maintains current database schema patterns
7. AI summarization is covered by appropriate tests including API endpoint and UI interaction
8. Rich-text editor follows existing Shadcn-ui component patterns and accessibility standards
9. No regression in existing authentication or navigation functionality verified

## Tasks / Subtasks

- [ ] Task 1: Create Notes Database Schema (AC: 3, 4, 6)

  - [ ] Add notes table to `apps/server/src/db/schema/` with proper user relationships
  - [ ] Include fields: id, title, content, created_at, updated_at, user_id (foreign key)
  - [ ] Set up proper Drizzle relationships with existing auth.user table
  - [ ] Run database migration to create table
- [ ] Task 2: Implement Notes API Endpoints (AC: 2, 3, 5)

  - [ ] Create notes router in `apps/server/src/routers/notes.ts`
  - [ ] Implement CRUD operations: create, read, update, delete notes
  - [ ] Add AI summarization endpoint using Vercel AI SDK with Google AI
  - [ ] Add protected procedures with authentication middleware
  - [ ] Include proper Zod validation schemas for input/output
- [ ] Task 3: Build Rich-Text Editor Component (AC: 1, 8)

  - [ ] Create rich-text editor component in `apps/web/src/components/notes/`
  - [ ] Implement formatting controls (bold, italic, headers, lists)
  - [ ] Add auto-save functionality with debounced updates
  - [ ] Follow Shadcn-ui design patterns and accessibility standards
  - [ ] Include proper keyboard navigation and screen reader support
- [ ] Task 4: Create Notes Management UI (AC: 1, 3, 8)

  - [ ] Build notes list/grid view component
  - [ ] Create note detail/edit view with rich-text editor
  - [ ] Add note creation flow from dashboard
  - [ ] Implement note deletion with confirmation
  - [ ] Add loading states and error handling
- [ ] Task 5: Integrate AI Summarization UI (AC: 2, 8)

  - [ ] Add summarization button to note editor
  - [ ] Create summary format selection (executive, bullet points, action items)
  - [ ] Display generated summaries in note interface
  - [ ] Add summary loading states and error handling
  - [ ] Follow existing AI integration patterns
- [ ] Task 6: Client-Side Integration (AC: 5, 7)

  - [ ] Set up oRPC client for notes operations in `apps/web/src/utils/orpc.ts`
  - [ ] Integrate TanStack Query for notes data fetching and caching
  - [ ] Add proper error handling with toast notifications
  - [ ] Implement optimistic updates for note saving
- [ ] Task 7: Testing Implementation (AC: 7, 9)

  - [ ] Write unit tests for notes API endpoints
  - [ ] Create E2E tests for note creation, editing, and summarization workflows
  - [ ] Test rich-text editor functionality and accessibility
  - [ ] Verify no regression in existing authentication flows
  - [ ] Test AI summarization with various content types

## Dev Notes

### Testing Standards

**Location**: E2E tests in `tests/e2e/`, unit tests co-located with source files
**Framework**: Playwright for E2E testing, Bun test runner for unit tests
**Standards**: [Source: architecture.md#Testing Architecture]

- Test structure organized in `tests/e2e/` directory
- API testing through browser interface for oRPC endpoints
- UI testing for component interaction and workflow validation
- Integration testing for full user journeys from frontend to backend
- Performance testing for faster execution compared to Jest-based solutions

### Architecture Context

**Technology Stack**: [Source: architecture.md#Technology Stack]

- **Backend**: Next.js API Routes, oRPC (1.8.6), Drizzle ORM (0.44.2), SQLite with LibSQL
- **Frontend**: Next.js 15.5.0 with App Router, TanStack Query (5.85.5), Shadcn-ui, Tailwind CSS
- **AI Integration**: Vercel AI SDK (5.0.39) with Google AI SDK

**Project Structure**: [Source: architecture.md#Project Structure]

- **Database Schemas**: `apps/server/src/db/schema/`
- **API Routers**: `apps/server/src/routers/`
- **Frontend Components**: `apps/web/src/components/`
- **UI Components**: `apps/web/src/components/ui/`

**Database Architecture**: [Source: architecture.md#Database Architecture]

- Existing user table in `apps/server/src/db/schema/auth.ts`
- Drizzle ORM with type-safe database queries
- Migration management with drizzle-kit
- Foreign key relationships with auth.user table required

**API Architecture (oRPC)**: [Source: architecture.md#API Architecture]

- **Server Side**: Context-aware procedures with authentication middleware in `apps/server/src/lib/orpc.ts`
- **Client Side**: TanStack Query integration in `apps/web/src/utils/orpc.ts`
- Type-safe error handling with ORPCError
- Automatic error handling with toast notifications

**Frontend Architecture**: [Source: architecture.md#Frontend Architecture]

- **Component Structure**: Shadcn-ui components in `components/ui/` built on Radix UI primitives
- **State Management**: TanStack Query for server state, React hooks for local state
- **Forms**: TanStack React Form (1.12.3) for form handling
- **Styling**: Tailwind CSS utility-first styling with Shadcn-ui design system

**AI Integration**: [Source: architecture.md#AI Integration]

- Vercel AI SDK integration for LLM interactions
- Google AI SDK for AI processing
- AI-specific routes and components pattern established
- Streamdown for markdown processing, Shiki for syntax highlighting

**Authentication System**: [Source: architecture.md#Authentication System]

- Better Auth (1.3.13) with server-side config at `apps/server/src/lib/auth.ts`
- Client-side auth client at `apps/web/src/lib/auth-client.ts`
- Protected procedures require authentication middleware
- User session management with IP and user agent tracking

**Code Quality Standards**: [Source: architecture.md#Ultracite]

- Biome (2.2.4) for linting and formatting
- Ultracite (5.4.4) for strict type safety and accessibility standards
- Zero configuration required, subsecond performance
- Maximum type safety and AI-friendly code generation

### File Locations

- **Notes Schema**: `apps/server/src/db/schema/notes.ts`
- **Notes Router**: `apps/server/src/routers/notes.ts`
- **Rich-Text Editor**: `apps/web/src/components/notes/rich-text-editor.tsx`
- **Notes Components**: `apps/web/src/components/notes/`
- **Notes Pages**: `apps/web/src/app/notes/`
- **E2E Tests**: `tests/e2e/notes.spec.ts`

### Technical Constraints

- Must use existing oRPC pattern for type-safe API communication
- Follow Ultracite accessibility and code quality rules
- Maintain compatibility with existing Better Auth system
- Use Drizzle ORM patterns for database operations
- Follow Shadcn-ui component patterns for consistent UI

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-28 | 1.0     | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used

Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

No significant debugging issues encountered during implementation

### Completion Notes List

- All tasks completed successfully with comprehensive functionality
- Database schema created and migrated successfully
- Complete CRUD API endpoints implemented with AI summarization
- Rich-text editor with formatting and accessibility features
- Full notes management UI with search, creation, editing, and deletion
- AI summarization with multiple output formats (executive, bullet points, action items)
- Client-side integration with TanStack Query and error handling
- E2E test suite created covering all major workflows
- Code follows project standards and passes linting

### File List

**Backend Files:**
- `apps/server/src/db/schema/notes.ts` - Notes database schema
- `apps/server/src/routers/notes.ts` - Notes API endpoints with CRUD and AI summarization
- `apps/server/src/db/index.ts` - Updated database exports
- `apps/server/.env` - Environment configuration for development

**Frontend Files:**
- `apps/web/src/components/notes/rich-text-editor.tsx` - Rich text editor component
- `apps/web/src/components/notes/notes-list.tsx` - Notes list and search component
- `apps/web/src/components/notes/note-editor.tsx` - Note editing interface with AI summarization
- `apps/web/src/app/notes/page.tsx` - Notes page with authentication
- `apps/web/src/app/notes/notes-app.tsx` - Main notes application component
- `apps/web/src/app/dashboard/dashboard.tsx` - Updated dashboard with notes integration
- `apps/web/src/index.css` - Updated global styles for rich text editor

**Test Files:**
- `tests/e2e/notes.spec.ts` - Comprehensive E2E test suite
- `apps/server/src/routers/notes.test.ts` - Unit tests for API endpoints

**Dependencies Added:**
- `nanoid` - Unique ID generation for notes
- `date-fns` - Date formatting utilities

## QA Results

*Results from QA Agent review will be populated here after implementation*
